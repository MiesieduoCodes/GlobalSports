rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Helper function to check if user is admin
    // Note: Admin users must have custom claims set via Firebase Admin SDK
    function isAdmin() {
      return isAuthenticated() && 
             request.auth.token.admin == true;
    }
    
    // For development: Allow all authenticated users to write
    // Remove this in production and use isAdmin() only
    function canWrite() {
      return isAuthenticated(); // Development mode - any authenticated user
      // return isAdmin(); // Production mode - uncomment this line
    }
    
    // News collection - public read, authenticated write (dev) / admin write (prod)
    match /news/{newsId} {
      allow read: if true; // Public read access
      allow create, update, delete: if canWrite();
    }
    
    // Extended news collection (newss) - public read, authenticated write (dev) / admin write (prod)
    match /newss/{newsId} {
      allow read: if true;
      allow create, update, delete: if canWrite();
    }
    
    // Matches collection - public read, authenticated write (dev) / admin write (prod)
    match /matches/{matchId} {
      allow read: if true;
      allow create, update, delete: if canWrite();
    }
    
    // Videos collection - public read, authenticated write (dev) / admin write (prod)
    match /videos/{videoId} {
      allow read: if true;
      allow create, update, delete: if canWrite();
    }
    
    // Players collection - public read, authenticated write (dev) / admin write (prod)
    match /players/{playerId} {
      allow read: if true;
      allow create, update, delete: if canWrite();
    }
    
    // Awards collection - public read, authenticated write (dev) / admin write (prod)
    match /awards/{awardId} {
      allow read: if true;
      allow create, update, delete: if canWrite();
    }
    
    // Navigation data - public read, authenticated write (dev) / admin write (prod)
    match /navData/{document=**} {
      allow read: if true;
      allow create, update, delete: if canWrite();
    }
    
    // Admin users collection - only admins can read/write
    match /adminUsers/{userId} {
      allow read, write: if isAdmin();
    }
    
    // Kids camp registrations - public write, admin read
    match /kidscampRegistrations/{registrationId} {
      allow create: if true; // Anyone can submit registration
      allow read, update, delete: if isAdmin(); // Only admins can view/manage
    }
    
    // Default deny for any other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

